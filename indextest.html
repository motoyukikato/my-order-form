<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JANå¯¾å¿œãƒ»å—æ³¨ã‚¢ãƒ—ãƒª</title>
    <style>
        body { font-family: sans-serif; padding: 20px; background: #f4f4f4; }
        .card { background: white; padding: 15px; border-radius: 8px; margin-bottom: 10px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        input, select, button { width: 100%; padding: 12px; margin: 8px 0; border: 1px solid #ccc; border-radius: 4px; box-sizing: border-box; }
        button { background: #00B900; color: white; border: none; font-weight: bold; cursor: pointer; }
        .btn-scan { background: #555; }
        .btn-add { background: #007bff; }
        #orderList { margin-top: 20px; border-top: 2px solid #00B900; padding-top: 10px; }
    </style>
</head>
<body>

    <div class="card">
        <h3>å•†å“å…¥åŠ›</h3>
        <button class="btn-scan" onclick="scanBarcode()">ğŸ“· ãƒãƒ¼ã‚³ãƒ¼ãƒ‰ã‚’èª­ã¿å–ã‚‹</button>
        <input type="text" id="janCode" placeholder="JANã‚³ãƒ¼ãƒ‰">
        <input type="text" id="itemName" placeholder="å•†å“å">
        <input type="number" id="quantity" value="1">
        <button class="btn-add" onclick="addToCart()">ï¼‹ ãƒªã‚¹ãƒˆã«è¿½åŠ </button>
    </div>

    <div id="orderList">
        <h3>æ³¨æ–‡ãƒªã‚¹ãƒˆ</h3>
        <div id="items"></div>
        <button onclick="sendOrder()">ã“ã®å†…å®¹ã§æ³¨æ–‡ã‚’ç¢ºå®šã™ã‚‹</button>
    </div>

    <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
    <script>
        let cart = [];

        async function initLiff() {
            await liff.init({ liffId: "YOUR_LIFF_ID" });
            if (!liff.isLoggedIn()) { liff.login(); }
        }
        initLiff();

        // ãƒãƒ¼ã‚³ãƒ¼ãƒ‰ã‚¹ã‚­ãƒ£ãƒ³æ©Ÿèƒ½
        async function scanBarcode() {
            if (!liff.isInClient()) {
                alert("LINEã‚¢ãƒ—ãƒªå†…ã§é–‹ã„ã¦ãã ã•ã„");
                return;
            }
            try {
                const result = await liff.scanCodeV2();
                document.getElementById('janCode').value = result.value;
                // æœ¬æ¥ã¯ã“ã“ã§JANã‚³ãƒ¼ãƒ‰ã‹ã‚‰å•†å“åã‚’æ¤œç´¢ã™ã‚‹DBãŒã‚ã‚‹ã¨ä¾¿åˆ©ã§ã™ãŒã€
                // ä»Šå›ã¯æ‰‹å…¥åŠ›ã‹ã€ç°¡æ˜“çš„ãªåç§°ã‚’å…¥ã‚Œã¾ã™
                document.getElementById('itemName').value = "èª­ã¿å–ã‚Šå•†å“ (" + result.value + ")";
            } catch (err) {
                console.error(err);
                alert("ã‚¹ã‚­ãƒ£ãƒ³ã«å¤±æ•—ã—ã¾ã—ãŸ");
            }
        }

        // ãƒªã‚¹ãƒˆã«è¿½åŠ 
        function addToCart() {
            const item = {
                jan: document.getElementById('janCode').value,
                name: document.getElementById('itemName').value,
                qty: document.getElementById('quantity').value
            };
            if (!item.name) return alert("å•†å“åã‚’å…¥åŠ›ã—ã¦ãã ã•ã„");
            
            cart.push(item);
            renderCart();
            
            // å…¥åŠ›æ¬„ã‚’ãƒªã‚»ãƒƒãƒˆ
            document.getElementById('janCode').value = "";
            document.getElementById('itemName').value = "";
            document.getElementById('quantity').value = "1";
        }

        // ç”»é¢ã«ãƒªã‚¹ãƒˆã‚’è¡¨ç¤º
        function renderCart() {
            const div = document.getElementById('items');
            div.innerHTML = cart.map((item, index) => `
                <div class="card">
                    ${item.name} x ${item.qty}å€‹<br>
                    <small>JAN: ${item.jan}</small>
                </div>
            `).join('');
        }

        // GASã¸é€ä¿¡
        async function sendOrder() {
            if (cart.length === 0) return alert("ãƒªã‚¹ãƒˆãŒç©ºã§ã™");
            
            const profile = await liff.getProfile();
            const data = {
                userName: profile.displayName,
                // ãƒªã‚¹ãƒˆã‚’1ã¤ã®æ–‡å­—åˆ—ã«ã¾ã¨ã‚ã¦é€ä¿¡
                itemName: cart.map(i => `${i.name}(${i.jan})`).join(", "),
                quantity: cart.reduce((sum, i) => sum + parseInt(i.qty), 0),
                totalAmount: 0 // å¿…è¦ã«å¿œã˜ã¦è¨ˆç®—
            };

            const response = await fetch("YOUR_GAS_URL", {
                method: "POST",
                body: JSON.stringify(data)
            });

            if (response.ok) {
                alert("æ³¨æ–‡ãŒå®Œäº†ã—ã¾ã—ãŸï¼");
                liff.closeWindow();
            }
        }
    </script>
</body>
</html>