<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ご注文アプリ</title>
    <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
    <style>
        /* アプリっぽいデザインのための簡易CSS */
        body { font-family: sans-serif; margin: 0; padding: 10px; background: #f4f4f4; }
        .item-card { background: white; border-radius: 8px; padding: 10px; margin-bottom: 10px; display: flex; align-items: center; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .item-img { width: 80px; height: 80px; object-fit: cover; margin-right: 15px; border-radius: 4px; }
        .item-info { flex-grow: 1; }
        .qty-input { width: 60px; padding: 5px; font-size: 16px; }
        .btn-submit { width: 100%; padding: 15px; background: #00b900; color: white; border: none; border-radius: 30px; font-size: 18px; font-weight: bold; margin-top: 20px; }
    </style>
</head>
<body>
    <div id="app">
        <h2>商品一覧</h2>
        <div id="itemList">読み込み中...</div>
        <button class="btn-submit" onclick="submitOrder()">注文を確定する</button>
    </div>

    <script>
        const GAS_URL = "https://script.google.com/macros/s/AKfycbwJOMeKcfruh3xXxNnY4Euxw2--pfdnJqRpEj5kztPMyQWSVs5W53B4BBtIyogeXZEfbQ/exec"; // 先ほどデプロイしたGASのURL

        // ① 起動時に在庫データを取得
        async function loadItems() {
            const res = await fetch(GAS_URL + "?type=getList");
            const items = await res.json();
            const listDiv = document.getElementById('itemList');
            listDiv.innerHTML = "";

            items.forEach(item => {
                // 画像JSONの解析
                let imgHtml = "";
                if(item.imageJson) {
                    const imgData = JSON.parse(item.imageJson);
                    // ※Googleドライブの画像を表示するには直リンク変換など工夫が必要ですが、ここでは枠だけ作成
                    imgHtml = `<img src="dummy.png" class="item-img">`; 
                }

                listDiv.innerHTML += `
                    <div class="item-card">
                        ${imgHtml}
                        <div class="item-info">
                            <div><strong>${item.name}</strong> (${item.id})</div>
                            <div>在庫: ${item.stock} ${item.unit}</div>
                            <input type="number" class="qty-input" data-id="${item.id}" placeholder="0">
                        </div>
                    </div>
                `;
            });
        }

        // ② 注文送信処理
        async function submitOrder() {
            // ここにPowerAppsのロジック（メール本文作成や在庫計算）を移植したJSを書きます
            alert("GASへデータを送信します...");
        }

        // LIFF初期化
        liff.init({ liffId: "2008942151-9x7S0H52" }).then(() => {
            loadItems();
        });
    </script>
</body>
</html>
