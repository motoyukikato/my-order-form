<script src="https://unpkg.com/@zxing/library@latest"></script>

<script>
    const codeReader = new ZXing.BrowserMultiFormatReader();
    let selectedDeviceId;

    function startScanner() {
        codeReader.listVideoInputDevices()
            .then((videoInputDevices) => {
                // 背面カメラを自動選択（なければ最初のカメラ）
                selectedDeviceId = videoInputDevices.length > 1 ? videoInputDevices[1].deviceId : videoInputDevices[0].deviceId;
                
                codeReader.decodeFromVideoDevice(selectedDeviceId, 'video', (result, err) => {
                    if (result) {
                        console.log(result.text);
                        document.getElementById('status').innerText = "成功: " + result.text;
                        addItemToCart(result.text);
                        // 連続読み取りを防ぐ場合はここで一旦止める
                    }
                });
            })
            .catch((err) => console.error(err));
    }
</script>

<video id="video" width="100%" height="300" style="border: 1px solid gray"></video>
